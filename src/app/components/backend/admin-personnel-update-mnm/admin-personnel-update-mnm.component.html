<app-admin-menu [menu]="'personnel'"></app-admin-menu>
<app-admin-page-header [name]="'ข้อมูลบุคลากร'"></app-admin-page-header>
<hr>
<div class="container-fluid">
	<div class="row">
		<div class="col">
			<form [formGroup]="form"  (ngSubmit)="onSubmit()">
				<div class="row form-group">
					<div class="col-6 offset-3 text-center">&nbsp;&nbsp;&nbsp;
						<div>
							<div class="progress" [ngClass]="{ 'active-progress' : progress >= 1 }">&nbsp;&nbsp;&nbsp; 1</div>
							<div class="line-top"></div>
							<div class="progress" [ngClass]="{ 'active-progress' : progress >= 2 }">&nbsp;&nbsp;&nbsp; 2</div>
							<div class="line-top"></div>
							<div class="progress" [ngClass]="{ 'active-progress' : progress == 3 }">&nbsp;&nbsp;&nbsp; 3</div>
						</div>
					</div>
				</div>
				<div class="row form-group">
					<div class="col">
						&nbsp;
					</div>
				</div>

				<div *ngIf="progress == 1">
					<div class="row form-group">
						<div class="col">
							<fieldset>
								<label><h5>ข้อมูลส่วนตัว</h5></label>
							</fieldset>
							<div class="row pb-2">
								<div class="col-2">
									  <label for="floatingInput">คำนำหน้า</label>
									  <select class="form-select" aria-label="Default select example" formControlName="prefix">
										  <option value="นาย">นาย</option>
										  <option value="นาง">นาง</option>
										  <option value="นางสาว">นางสาว</option>
										  <option value="Mr.">Mr.</option>
										  <option value="Miss.">Miss.</option>
										  <option value="Mrs.">Mrs.</option>
										</select>
								</div>
								<div class="col">
									  <label for="floatingInput">ชื่อ *</label>
									  <input type="text" class="form-control" id="floatingInput" placeholder="" formControlName="name" [ngClass]="{ 'is-invalid': f['name'].errors }">
								</div>
								<div class="col">
									  <label for="floatingInput">สกุล *</label>
									  <input type="text" class="form-control" id="floatingInput" placeholder="" formControlName="lastname" [ngClass]="{ 'is-invalid': f['lastname'].errors }">
								</div>
							</div>

							<div class="row pb-2">
								<div class="col-2">
									  <label for="floatingInput">วันเกิด</label>
									  <input type="date" class="form-control" id="floatingInput" placeholder="" formControlName="birth_date">
								</div>
								<div class="col">
									  <label for="floatingInput">ประเภทบุคลากร *</label>
									  <select class="form-select" aria-label="Default select example" formControlName="position"  [ngClass]="{ 'is-invalid': f['position'].errors }">
										  <option value="พนักงานมหาวิทยาลัย">พนักงานมหาวิทยาลัย</option>
										  <option value="ข้าราชการ">ข้าราชการ</option>
										  <option value="ลูกจ้างชั่วคราว">ลูกจ้างชั่วคราว</option>
										  <option value="ลูกจ้างประจำ">ลูกจ้างประจำ</option>
										  <option value="พนักงานราชการ">พนักงานราชการ</option>
										</select>
								</div>
								<div class="col">
									  <label for="floatingInput">สายงาน *</label>
										<select class="form-select" aria-label="Default select example" formControlName="line_work"  [ngClass]="{ 'is-invalid': f['line_work'].errors }">
										  <option value="วิชาการ">วิชาการ</option>
										  <option value="สนับสนุน">สนับสนุน</option>
										</select>
								</div>
							</div>
							<div class="row pb-2">
								<div class="col-2">
									&nbsp;
								</div>
								<div class="col-5">
									  <label for="floatingInput">ตำแหน่งทางวิชาการ *</label>
										<select class="form-select" aria-label="Default select example" formControlName="position_academic"  [ngClass]="{ 'is-invalid': f['position_academic'].errors }">
										  <option value="ศาสตราจารย์เกียรติคุณ (กิตติคุณ)">ศาสตราจารย์เกียรติคุณ (กิตติคุณ)</option>
										  <option value="ศาสตราจารย์">ศาสตราจารย์</option>
										  <option value="ศาสตราจารย์พิเศษ">ศาสตราจารย์พิเศษ</option>
										  <option value="ศาสตราจารย์อาคันตุกะ">ศาสตราจารย์อาคันตุกะ</option>
										  <option value="รองศาสตราจารย์">รองศาสตราจารย์</option>
										  <option value="ผู้ช่วยศาสตราจารย์">ผู้ช่วยศาสตราจารย์</option>
										  <option value="อาจารย์">อาจารย์</option>
										</select>
								</div>
								<div class="col-5">
									  <label for="floatingInput">งบประมาณในการเลื่อนขั้นเงินเดือน</label>
										<select class="form-select" aria-label="Default select example" formControlName="promote_budget">
										  <option value="งบประมาณแผ่นดิน">งบประมาณแผ่นดิน</option>
										  <option value="รายได้มหาวิทยาลัย">รายได้มหาวิทยาลัย</option>
										  <option value="อื่นๆ">อื่นๆ</option>
										</select>
								</div>
							</div>
							<div class="row pb-2">
								<div class="col-2">
									&nbsp;
								</div>
								<div class="col-5">
									  <label for="floatingInput">ชุดแบบประเมิน *</label>
										<select class="form-select" aria-label="Default select example" formControlName="personnel_type"  [ngClass]="{ 'is-invalid': f['personnel_type'].errors }">
										  <option value="อาจารย์ทั่วไป">อาจารย์ทั่วไป</option>
										  <option value="อาจารย์ที่เน้นวิชา">อาจารย์ที่เน้นวิชา</option>
										  <option value="อาจารย์ที่เน้นวิจัย">อาจารย์ที่เน้นวิจัย</option>
										  <option value="อาจารย์ที่เน้นบริการวิชาการ">อาจารย์ที่เน้นบริการวิชาการ</option>
										  <option value="หัวหน้าสาขา">หัวหน้าสาขา</option>
										  <option value="ผู้ช่วยและรองคณบดี">ผู้ช่วยและรองคณบดี</option>
										</select>
								</div>
								<div class="col-5">
									  <label for="floatingInput">ตำแหน่งตามสายการบังคับบัญชา</label>
										<select class="form-select" aria-label="Default select example" formControlName="supervisor_type">
										  <!-- <option value="คณาจารย์">คณาจารย์</option> -->
										  <option value="">ไม่มี</option>
										  <option value="หัวหน้าสาขา">หัวหน้าสาขา</option>
										  <option value="รองคณบดี">รองคณบดี</option>
										  <option value="คณบดี">คณบดี</option>
										</select>
								</div>
							</div>
						</div>
					</div>
					<hr>
					<div class="row form-group">
						<div class="col">
							<fieldset>
								<label><h5>ผู้บังคับบัญชา</h5></label>
							</fieldset>
							<div class="row pb-2">
								<div class="col-2">
									&nbsp;
								</div>
								<div class="col">
									  <label for="floatingInput">ผู้บังคับบัญชา ลำดับที่ 1 *</label>
									  <select class="form-select" aria-label="Default select example" formControlName="supervisor_level_st" [ngClass]="{ 'is-invalid': f['supervisor_level_st'].errors }">
										  <option value="">กรุณาเลือก..</option>
										  <option value="หัวหน้าสาขา">หัวหน้าสาขา</option>
										  <option value="รองคณบดี">รองคณบดี</option>
										  <option value="รองคณบดีและคณบดี">รองคณบดีและคณบดี</option>
										  <option value="คณบดี">คณบดี</option>
										</select>
								</div>
								<div class="col">
									  <label for="floatingInput">ผู้บังคับบัญชา ลำดับที่ 2</label>
										<select class="form-select" aria-label="Default select example" formControlName="supervisor_level_nd">
										  <option value="">กรุณาเลือก..</option>
										  <option value="หัวหน้าสาขา">หัวหน้าสาขา</option>
										  <option value="รองคณบดี">รองคณบดี</option>
										  <option value="รองคณบดีและคณบดี">รองคณบดีและคณบดี</option>
										  <option value="คณบดี">คณบดี</option>
										</select>
								</div>
							</div>

							<div class="row pb-2">
								<div class="col-2">
									&nbsp;
								</div>
								<div class="col">
									  <label for="floatingInput">ผู้บังคับบัญชา ลำดับที่ 3</label>
									  <select class="form-select" aria-label="Default select example" formControlName="supervisor_level_rd">
										  <option value="">กรุณาเลือก..</option>
										  <option value="หัวหน้าสาขา">หัวหน้าสาขา</option>
										  <option value="รองคณบดี">รองคณบดี</option>
										  <option value="รองคณบดีและคณบดี">รองคณบดีและคณบดี</option>
										  <option value="คณบดี">คณบดี</option>
										</select>
								</div>
								<div class="col">
									  <label for="floatingInput">ผู้บังคับบัญชา ลำดับที่ 4</label>
										<select class="form-select" aria-label="Default select example" formControlName="supervisor_level_th">
										  <option value="">กรุณาเลือก..</option>
										  <option value="หัวหน้าสาขา">หัวหน้าสาขา</option>
										  <option value="รองคณบดี">รองคณบดี</option>
										  <option value="รองคณบดีและคณบดี">รองคณบดีและคณบดี</option>
										  <option value="คณบดี">คณบดี</option>
										</select>
								</div>
							</div>
						</div>
					</div>
					<hr>
					<div class="row form-group">
						<div class="col">
							<fieldset>
								<label><h5>หน่วยงาน</h5></label>
							</fieldset>
							<div class="row pb-2">
								<div class="col-2">
									&nbsp;
								</div>
								<div class="col">
									  <label for="floatingInput">หน่วยงานต้นสังกัด *</label>
									  <select class="form-select" aria-label="Default select example" formControlName="agency" [ngClass]="{ 'is-invalid': f['agency'].errors }">
										  <option value="คณะบริหารธุรกิจ">คณะบริหารธุรกิจ</option>
										  <option value="อื่นๆ">อื่นๆ (โปรดระบุ)</option>
										  <!-- <option *ngFor="let agency of work_unit_list" value="{{agency.value}}">{{agency.name}}</option> -->
										</select>
								</div>
								<div class="col">
									  <label for="floatingInput">หน่วยงานที่ปฎิบัติงาน</label>
									  <select class="form-select" aria-label="Default select example" formControlName="work_unit">
										  <option value="">กรุณาเลือก..</option>
										  <option *ngFor="let work_unit of work_unit_list" value="{{work_unit.value}}">{{work_unit.name}}</option>
										</select>
								</div>
							</div>

							<div class="row pb-2">
								<div class="col-2">
									&nbsp;
								</div>
								<div class="col-5">
									  <label for="floatingInput">รายละเอียด</label>
									  <textarea  class="form-control" formControlName="agency_detail" rows="4"></textarea>
								</div>
							</div>
							<div class="alert alert-danger" *ngIf="error_message != null">
						      {{ error_message }}
					    	</div>
							<div class="row">
								<div class="col text-center">
									<a class="btn btn-light" [routerLink]="['/admin-personnel-management']">ยกเลิก</a>&nbsp;
									<button class="btn btn-dark" (click)="nextStep(2)">ถัดไป</button>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div *ngIf="progress == 2">
					<div class="row form-group">
						<div class="col">
							<fieldset>
								<label><h5>ข้อมูลการติดต่อ</h5></label>
							
								<div class="row">
									
									<div class="col-6">
										  <label for="floatingInput">เบอร์โทรศัพท์ *</label>
										  <input type="text" class="form-control" id="floatingInput" placeholder="" formControlName="mobile_work" [ngClass]="{ 'is-invalid': submitted && f['mobile_work'].errors }">
									</div>

									<div class="col-3">
										  <label for="floatingInput">เบอร์ติดต่อภายใน</label>
										  <input type="text" class="form-control" id="floatingInput" placeholder="" formControlName="mobile_work_internal">
									</div>
									
								</div>

								<div class="row">
									
									<div class="col-6">
										  <label for="floatingInput">เบอร์โทรศัพท์มือถือ *</label>
										  <input type="text" class="form-control" id="floatingInput" placeholder="" formControlName="mobile" [ngClass]="{ 'is-invalid': f['mobile'].errors }">
									</div>

								</div>

								<div class="row">
									
									<div class="col-6">
										  <label for="floatingInput">อีเมล์มหาวิทยาลัย *</label>
										  <input type="text" class="form-control" id="floatingInput" placeholder="" formControlName="email" [ngClass]="{ 'is-invalid': f['email'].errors }">
									</div>

								</div>

								<div class="row">
									
									<div class="col-6">
										  <label for="floatingInput">อีเมล์ *</label>
										  <input type="text" class="form-control" id="floatingInput" placeholder="" formControlName="email_work" [ngClass]="{ 'is-invalid': f['email_work'].errors }">
									</div>

								</div>
							</fieldset>
							<hr>
							<fieldset>
								<label><h5>ไฟล์ประวัติบุคคล</h5></label>
								<div class="row">
									<div class="col">
										  <label for="floatingInput">ไฟล์แนบ</label>
										  <input 
								            formControlName="file"
								            id="file" 
								            type="file" 
								            class="form-control"
								            (change)="onFileChange($event)">
									</div>
								</div>
								<div class="row" *ngIf="attach_file_data && attach_file_data.file_path != null">
									<div class="col">
										<div class="alert alert-info">
											ไฟล์ปัจจุบัน : <a href="{{ storage_url }}/{{attach_file_data.file_path}}" target="_blank">{{attach_file_data.file_name}}</a>
										</div>
									</div>
								</div>
							</fieldset>

							<div class="row" *ngIf="error_message != null">
								<div class="col">
									<div class="alert alert-danger">
										{{ error_message }}
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col text-center">
									<button class="btn btn-secondary" (click)="nextStep(1)" [disabled]="submitted">ย้อนกลับ</button>
									&nbsp;
									<button class="btn btn-success" type="submit" *ngIf="!submitted">บันทึกข้อมูล</button>
									<button type="button" class="btn btn-success" *ngIf="submitted" [disabled]="submitted">กำลังบันทึก..</button>
									&nbsp;
									<button type="button" class="btn btn-dark" (click)="nextStep(3)" [disabled]="submitted">ถัดไป</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		<div *ngIf="progress == 3">
			<app-admin-education-file-manage personnel_id="{{id}}"></app-admin-education-file-manage>
			<app-admin-work-info-file-manage personnel_id="{{id}}"></app-admin-work-info-file-manage>
			<app-admin-academic-file-manage personnel_id="{{id}}"></app-admin-academic-file-manage>
			<app-salary-manage personnel_id="{{id}}"></app-salary-manage>
			<div class="row">
				<div class="col text-center">
					<button type="button" class="btn btn-secondary" (click)="nextStep(2)">ย้อนกลับ</button>
				</div>
			</div>
		</div>
	</div>
</div>
<ng-template #modalSuccessData let-modal>
  <div class="modal-body text-center">
    <br><br><br>
  	<h3>บันทึกข้อมูลสำเร็จ !</h3>
    <br><br>
    <button type="button" class="btn btn-primary" (click)="modal.close('Confirm')">ปิด</button>
    <br>
  </div>
</ng-template>
<ng-template #modalErrorData let-modal>
  <div class="modal-body text-center">
    <br><br><br>
  	<h3>{{ error_message }}</h3>
    <br><br>
    <button type="button" class="btn btn-primary" (click)="modal.close('Confirm')">ปิด</button>
    <br>
  </div>
</ng-template>